<?php // **************************************************************************// * Get requires// **************************************************************************require_once("../../class2.php");require_once(e_ADMIN . "auth.php");require_once(e_HANDLER . "userclass_class.php");if (e_LANGUAGE !="English" && file_exists(e_PLUGIN . "phonedir/languages/admin/" . e_LANGUAGE . ".php")){    include_once(e_PLUGIN . "phonedir/languages/admin/" . e_LANGUAGE . ".php");} else{    include_once(e_PLUGIN . "phonedir/languages/admin/English.php");} // **************************************************************************// Create objects// **************************************************************************$pdir_db =new DB;$pdir_action =$_POST['pdir_action'];$pdir_convert =new convert;// **************************************************************************// * If we are updating then update or insert the record// **************************************************************************if ($pdir_action =='update'){    if (empty($_POST['pd_job_title']))    {        $pdir_text .="<table style ='width:97%' class ='fborder'><tr><td  class ='fcaption' style='text-align: left;' colspan ='2'><strong>" . phonedir_ADLAN_74 . "</strong></td></tr></table>";    }     else    {        $pd_job_id =$_POST['pd_job_id'];        if ($pd_job_id ==0)        {             // New record so add it            $pdir_args .="		'0',		'" . $_POST['pd_job_title'] . "',		'" . time() . "',		'" . USERID . "." . USERNAME . "'		";            if ($pdir_db->db_Insert("pd_jobtitle", $pdir_args))            {                $pdir_msg .="<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><b>" . phonedir_ADLAN_50 . "</b></td></tr>";            }             else            {                $pdir_msg .="<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><b>" . phonedir_ADLAN_73 . "</b></td></tr>";            }         }         else        {             // Update existing            $pdir_args .="		pd_job_title ='" . $_POST['pd_job_title'] . "',		pd_job_updated ='" . time() . "',				pd_job_updatedby ='" . USERID . "." . USERNAME . "'		where pd_job_id ='$pd_job_id'";            if ($pdir_db->db_Update("pd_jobtitle", $pdir_args))            {                 // Changes saved                $pdir_msg .="<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><b>" . phonedir_ADLAN_49 . "</b></td></tr>";            }             else            {                 // changes not saved                $pdir_msg .="<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><b>" . phonedir_ADLAN_72 . "</b></td></tr>";            }         }     } } // We are creating, editing or deleting a recordif ($pdir_action =='dothings'){    $pd_job_id =$_POST['pdir_selcat'];    $pdir_do =$_POST['pdir_recdel'];    $pdir_dodel =false;    switch ($pdir_do)    {        case '1': // Edit existing record            {                // We edit the record                $pdir_db->db_Select("pd_jobtitle", "*", "pd_job_id ='$pd_job_id'");                $pdir_row =$pdir_db->db_Fetch() ;                extract($pdir_row);                $pdir_cap1 =phonedir_ADLAN_10 . " " . phonedir_ADLAN_57;                break;            }         case '2': // New department            {                // Create new record                $pd_job_id =0;                 // set all fields to zero/blank                $pdir_cap1 =phonedir_ADLAN_11 . " " . phonedir_ADLAN_57;                break;            }         case '3':            {                 // delete the record                if ($_REQUEST['pdir_okdel'] =='1')                {                     // Check if category not used in any other table                    $pdir_countd =$pdir_db->db_Count("pd_directory", "(*)", " where pd_jobtitle ='$pd_job_id'");                    if ($pdir_countd ==0)                    {                        $pdir_msg .=phonedir_ADLAN_54 . "<br />";                        if ($pdir_db->db_Delete("pd_jobtitle", " pd_job_id ='$pd_job_id'"))                        {                            $pdir_text .="<table style ='width:97%' class ='fborder'><tr>						<td  class='fcaption' style='text-align: left;' colspan='2'>" . phonedir_ADLAN_12. "</td></tr>						<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><strong>" . phonedir_ADLAN_34 . "</strong></td></tr>						<tr><td  class ='fcaption' style='text-align: left;' colspan ='2'><a href=''>" . phonedir_ADLAN_69 . "</a></td>						</tr></table>";                        }                         else                        {                            $pdir_text .="<table style ='width:97%' class ='fborder'><tr>						<td  class='fcaption' style='text-align: left;' colspan='2'>" . phonedir_ADLAN_12. "</td></tr>						<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><strong>" . phonedir_ADLAN_75 . "</strong></td></tr>						<tr><td  class ='fcaption' style='text-align: left;' colspan ='2'><a href=''>" . phonedir_ADLAN_69 . "</a></td>						</tr></table>";                        }                     }                     else                    {                        $pdir_text .="<table style ='width:97%' class ='fborder'><tr>						<td  class='fcaption' style='text-align: left;' colspan='2'>" . phonedir_ADLAN_12. "</td></tr>						<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><strong>" . phonedir_ADLAN_33 . "</strong></td></tr>						<tr><td  class ='fcaption' style='text-align: left;' colspan ='2'><a href=''>" . phonedir_ADLAN_69 . "</a></td>						</tr></table>";                    }                 }                 else                {                    $pdir_text .="<table style ='width:97%' class ='fborder'><tr>					<td  class='fcaption' style='text-align: left;' colspan='2'>" . phonedir_ADLAN_12. "</td></tr>						<tr><td  class ='forumheader3' style='text-align: left;' colspan ='2'><strong>" . phonedir_ADLAN_27 . "</strong></td></tr>					<tr><td  class ='fcaption' style='text-align: left;' colspan ='2'><a href=''>" . phonedir_ADLAN_69 . "</a></td>					</tr></table>";                }                 $pdir_dodel =true;            }     }     if (!$pdir_dodel)    {        if ($pd_job_id > 0)        {            $pdir_db->db_Select("pd_jobtitle", "*", "pd_job_id ='$pd_job_id'");            $sqlrow =$pdir_db->db_Fetch();            extract($sqlrow);        }         $pdir_text .="<form id ='edcat' name ='edcat' method ='post' action ='" . e_SELF . "'>	<input type ='hidden' name ='pd_job_id' value ='$pd_job_id' />	<input type ='hidden' name ='pdir_action' value ='update' />	<table width ='97%' class ='fborder'>		<tr><td colspan ='2' class ='fcaption'>" . $pdir_cap1 . "</td></tr>  <tr>    <td width='40%' class ='forumheader3'>" . phonedir_ADLAN_57 . "</td>    <td width='60%' class ='forumheader3'><input size ='40' type ='text' class='tbox' name='pd_job_title' value ='$pd_job_title' /></td>  </tr>    <tr>    <td width='40%' class ='forumheader3'>" . phonedir_ADLAN_55 . "</td>    <td width='60%' class ='forumheader3'>" . ($pd_job_updated <> 0?$pdir_convert->convert_date($pd_job_updated, "long"):"&nbsp;") . "</td>  </tr>";        $pdir_posterarray =explode(".", $pd_job_updatedby);        $pdir_userid =$pdir_posterarray[0];        $pdir_username =$pdir_posterarray[1];        $pdir_text .="<tr>    <td width='40%' class ='forumheader3'>" . phonedir_ADLAN_56 . "</td>    <td width='60%' class ='forumheader3'><a href ='../../user.php?id.$pdir_userid'>" . $pdir_username . "</a></td>  </tr>  <tr>    <td colspan ='2' class ='fcaption'><input type ='submit' name='pdir_catsave' class='button' value =" . phonedir_ADLAN_66 . " /></td>  </tr>  </table></form>";    } } else{     // Get the department names to display in combo box    // then display actions available    if ($pdir_db->db_Select("pd_jobtitle", "pd_job_id,pd_job_title", " order by pd_job_title", "nowhere"))    {        while ($pdir_row =$pdir_db->db_Fetch())        {            extract($pdir_row);            $pdir_catopt .="<option value ='$pd_job_id'>$pd_job_title</option>";        }     }     else    {        $pdir_catopt .="<option value ='0'>" . phonedir_ADLAN_100 . "</option>";    }     $pdir_text .="<form id='pdirform' method='post' action='" . e_SELF . "'>	<table style='width:97%' class='fborder'>	<tr><td colspan='2' class='fcaption'>" . phonedir_ADLAN_9 . "</td></tr>$pdir_msg	<tr><td style='width:20%' class='forumheader3'><input type='hidden' value='dothings' name='pdir_action' />" . phonedir_ADLAN_9 . "</td><td  class='forumheader3'><select name='pdir_selcat' class='tbox'>$pdir_catopt</select></td></tr>	<tr><td style='width:20%' class='forumheader3'>" . phonedir_ADLAN_65 . "</td><td  class='forumheader3'>	<input type='radio' name='pdir_recdel' value='1' checked='checked' /> " . phonedir_ADLAN_10 . "<br />	<input type='radio' name='pdir_recdel' value='2' /> " . phonedir_ADLAN_11 . "<br />	<input type='radio' name='pdir_recdel' value='3' /> " . phonedir_ADLAN_12 . "	<input type='checkbox' name='pdir_okdel' value='1' />" . phonedir_ADLAN_13 . "</td></tr>	<tr><td colspan='2' class='fcaption'  style='text-align: left;'><input type='submit' name='submits' value='" . phonedir_ADLAN_14 . "' class='button' /></td></tr>	</table></form>";} $ns->tablerender(phonedir_ADLAN_9, $pdir_text);require_once(e_ADMIN . "footer.php");?>